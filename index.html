<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#ff69b4">
    <meta name="description" content="Jeu de mots croisÃ©s chrÃ©tiens avec un design kawaii rose Ã©lÃ©gant">
    <title>ğŸ’• Mots En Croix ChrÃ©tiens ğŸ’•</title>
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ff69b4">
    
    <!-- iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Mots Croix">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-192x192.png">
    
    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="icons/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Fond animÃ© avec lignes ondulÃ©es -->
    <div class="background-waves">
        <div class="wave wave-1"></div>
        <div class="wave wave-2"></div>
        <div class="wave wave-3"></div>
        <div class="wave wave-4"></div>
    </div>

    <!-- Ã‰toiles scintillantes -->
    <div class="background-stars">
        <div class="star s1"></div>
        <div class="star s2"></div>
        <div class="star s3"></div>
        <div class="star s4"></div>
        <div class="star s5"></div>
    </div>

    <div class="game-container">
        <!-- Bouton Multijoueur Flottant -->
        <div id="multiplayerFloatingBtn" class="multiplayer-floating-btn">
            <button class="floating-btn">ğŸ‘¥ 2J</button>
            <div id="multiplayerDropdown" class="multiplayer-dropdown hidden">
                <div class="dropdown-header">
                    <h4>ğŸ® Mode CoopÃ©ratif</h4>
                </div>
                <input type="text" id="multiplayerPlayerNameFloat" placeholder="Votre nom" class="kawaii-input" style="width: 100%; margin: 10px 0; padding: 10px; border: 2px solid #ff69b4; border-radius: 8px; font-size: 14px;">
                <button id="createRoomBtnFloat" class="dropdown-button create-btn">
                    ğŸ® CrÃ©er une Partie
                </button>
                <div class="dropdown-divider">â”€â”€â”€ OU â”€â”€â”€</div>
                <input type="text" id="roomCodeInputFloat" placeholder="Code de la partie" class="kawaii-input" style="width: 100%; margin: 10px 0; padding: 10px; border: 2px solid #ff69b4; border-radius: 8px; font-size: 14px;">
                <button id="joinRoomBtnFloat" class="dropdown-button join-btn">
                    ğŸ”— Rejoindre
                </button>
                <div id="roomCodeDisplayFloat" class="hidden" style="margin-top: 15px; padding: 12px; background: #fff5f9; border-radius: 8px; text-align: center;">
                    <p style="font-size: 12px; margin-bottom: 5px;"><strong>Code:</strong></p>
                    <p id="roomCodeFloat" style="font-size: 18px; color: #ff1493; font-weight: bold; letter-spacing: 1px; user-select: all; margin-bottom: 8px;"></p>
                    <button id="copyCodeBtnFloat" class="dropdown-button" style="font-size: 12px; padding: 6px 12px;">
                        ğŸ“‹ Copier
                    </button>
                    <p style="margin-top: 8px; font-size: 11px; color: #666;">En attente...</p>
                </div>
            </div>
        </div>

        <div class="header">
            <h1>ğŸ™ Mots En Croix ChrÃ©tiens ğŸ™</h1>
            <p>Trouve les mots d'encouragement et les mots bibliques</p>
            <button id="installButton" class="install-button hidden">
                ğŸ“± Installer l'Application
            </button>
            <button id="menuButton" class="menu-button">
                â˜° Menu
            </button>
        </div>

        <div class="level-info">
            <div>
                <strong>Niveau: <span id="currentLevel">1</span>/77</strong>
            </div>
            <div class="score-display">
                Score: <span id="score">0</span> points
            </div>
        </div>

        <div id="startScreen">
            <button class="play-button" id="playButton">
                ğŸ® Jouer (<span id="clickCount">0</span>/7)
            </button>
            <div class="encouraging-words" id="encouragingWords"></div>
        </div>

        <div id="gameScreen" class="hidden">
            <div class="crossword-grid" id="crosswordGrid"></div>
            
            <div class="word-clues">
                <div class="clue-section">
                    <h3><span class="arrow-icon arrow-right"></span></h3>
                    <div id="horizontalClues"></div>
                </div>
                <div class="clue-section">
                    <h3><span class="arrow-icon arrow-down"></span></h3>
                    <div id="verticalClues"></div>
                </div>
            </div>

            <div class="controls">
                <button class="control-btn" id="checkButton">âœ… VÃ©rifier</button>
                <button class="control-btn" id="hintButton">ğŸ’¡ Indice</button>
                <button class="control-btn" id="shareButton" style="display:none;">ğŸ“¤ Partager</button>
                <button class="control-btn" id="nextLevelButton" style="display:none;">â¡ï¸ Niveau Suivant</button>
                <button class="control-btn" id="resetButton">ğŸ”„ Recommencer</button>
            </div>
        </div>
    </div>

    <!-- Modal Kawaii pour les notifications -->
    <div id="kawaiiModal" class="kawaii-modal hidden">
        <div class="kawaii-modal-overlay"></div>
        <div class="kawaii-modal-content">
            <div class="kawaii-modal-header">
                <span class="kawaii-modal-icon">âœ¨</span>
            </div>
            <div class="kawaii-modal-body">
                <p id="kawaiiModalMessage"></p>
            </div>
            <div class="kawaii-modal-footer">
                <button id="kawaiiModalBtn" class="kawaii-modal-button">OK</button>
            </div>
        </div>
    </div>

    <!-- Modal pour sauvegarder le score -->
    <div id="scoreModal" class="kawaii-modal hidden">
        <div class="kawaii-modal-overlay"></div>
        <div class="kawaii-modal-content">
            <div class="kawaii-modal-header">
                <span class="kawaii-modal-icon">ğŸ†</span>
            </div>
            <div class="kawaii-modal-body">
                <p><strong>FÃ©licitations ! ğŸ‰</strong></p>
                <p>Votre score: <span id="finalScoreDisplay">0</span> points</p>
                <p>Sauvegarder votre score en ligne:</p>
                <form id="scoreForm">
                    <input type="text" id="playerName" placeholder="Votre nom" required>
                    <input type="email" id="playerEmail" placeholder="Votre email" required>
                </form>
            </div>
            <div class="kawaii-modal-footer">
                <button id="saveScoreBtn" class="kawaii-modal-button">ğŸ’¾ Sauvegarder</button>
                <button id="skipScoreBtn" class="kawaii-modal-button secondary">Passer</button>
            </div>
        </div>
    </div>

    <!-- Modal de connexion cloud -->
    <div id="cloudModal" class="kawaii-modal hidden">
        <div class="kawaii-modal-overlay"></div>
        <div class="kawaii-modal-content">
            <div class="kawaii-modal-header">
                <span class="kawaii-modal-icon">â˜ï¸</span>
            </div>
            <div class="kawaii-modal-body">
                <p><strong>Connexion Cloud</strong></p>
                <p>Connectez-vous pour sauvegarder automatiquement vos scores en ligne</p>
                <form id="cloudForm">
                    <input type="text" id="cloudPlayerName" placeholder="Votre nom" required>
                    <input type="email" id="cloudPlayerEmail" placeholder="Votre email" required>
                </form>
            </div>
            <div class="kawaii-modal-footer">
                <button id="cloudConnectSubmitBtn" class="kawaii-modal-button">âœ… Se connecter</button>
                <button id="cloudCancelBtn" class="kawaii-modal-button secondary">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Modal de menu -->
    <div id="menuModal" class="kawaii-modal hidden">
        <div class="kawaii-modal-overlay"></div>
        <div class="kawaii-modal-content menu-modal-content">
            <div class="menu-header">
                <h2 id="menuTitle">âš™ï¸ ParamÃ¨tres</h2>
                <button id="closeMenuBtn" class="close-menu-btn">âœ•</button>
            </div>

            <!-- Onglets de navigation -->
            <div class="menu-tabs">
                <button class="menu-tab active" data-tab="settings">
                    âš™ï¸ Menu
                </button>
                <button class="menu-tab" data-tab="chat">
                    ğŸ’¬ Chat
                </button>
            </div>

            <!-- Contenu Onglet Menu -->
            <div id="settingsTabContent" class="menu-tab-content active">
                <div class="menu-section">
                <h3>â˜ï¸ Connexion Cloud</h3>
                <button id="menuCloudBtn" class="menu-cloud-btn">
                    â˜ï¸ Connexion Cloud
                </button>
                <p class="menu-description">Sauvegardez vos scores automatiquement en ligne</p>
            </div>

            <div class="menu-section">
                <h3>ğŸ† Collection de MÃ©dailles</h3>
                <button id="achievementsBtn" class="menu-cloud-btn">
                    ğŸ† Voir mes mÃ©dailles
                </button>
                <p class="menu-description">Consultez vos rÃ©compenses et achievements</p>
            </div>

            <div class="menu-section">
                <h3>ğŸŒ Langue / Language</h3>
                <div id="menuLanguageSelector" class="menu-language-selector"></div>
            </div>

            <div class="menu-section">
                <h3>ğŸ”Š Audio</h3>
                <div class="audio-controls">
                    <div class="audio-control-item">
                        <label for="musicVolume">ğŸµ Musique</label>
                        <input type="range" id="musicVolume" min="0" max="100" value="50">
                        <span id="musicVolumeValue">50%</span>
                    </div>
                    <div class="audio-control-item">
                        <label for="soundVolume">ğŸ”” Effets sonores</label>
                        <input type="range" id="soundVolume" min="0" max="100" value="50">
                        <span id="soundVolumeValue">50%</span>
                    </div>
                </div>
            </div>

                <div class="menu-section">
                    <h3>â„¹ï¸ Ã€ propos</h3>
                    <div class="about-info">
                        <p class="about-item">
                            <strong>ğŸ¨ Artiste:</strong>
                            <a href="#" id="artistLink" class="info-link">Voir le profil</a>
                        </p>
                        <p class="about-item">
                            <strong>âœ¨ CrÃ©ation:</strong> Jeu de mots croisÃ©s chrÃ©tiens avec design kawaii
                        </p>
                        <p class="about-item">
                            <strong>ğŸ’» Codage:</strong> DÃ©veloppÃ© avec Claude Code Pro
                        </p>
                    </div>
                </div>
            </div>

            <!-- Contenu Onglet Chat -->
            <div id="chatTabContent" class="menu-tab-content">
                <div class="menu-chat-header">
                    <div class="chat-header-info">
                        <span class="chat-icon">ğŸ’¬</span>
                        <span class="chat-title">Chat P2P</span>
                        <span id="menuChatParticipantCount" class="chat-participant-count">0 ğŸ‘¥</span>
                    </div>
                    <button id="menuChatUsername" class="chat-username-btn">Anonyme</button>
                </div>

                <!-- Interface de crÃ©ation/join de room -->
                <div id="menuChatRoomInterface" class="chat-room-interface">
                    <div class="chat-room-content">
                        <div class="chat-room-icon">ğŸ®</div>
                        <h3>Rejoindre le Chat</h3>
                        <p>CrÃ©ez une room ou rejoignez vos amis</p>

                        <button id="menuChatCreateRoomBtn" class="chat-room-btn create-btn">
                            ğŸ® CrÃ©er une Room
                        </button>

                        <div class="chat-divider">â”€â”€â”€ OU â”€â”€â”€</div>

                        <input type="text" id="menuChatRoomCodeInput" class="chat-room-input" placeholder="Code de la room" maxlength="50">
                        <button id="menuChatJoinRoomBtn" class="chat-room-btn join-btn">
                            ğŸ”— Rejoindre
                        </button>

                        <!-- Affichage du code aprÃ¨s crÃ©ation -->
                        <div id="menuChatRoomCodeDisplay" class="chat-room-code-display hidden">
                            <p><strong>Code de votre room:</strong></p>
                            <div id="menuChatRoomCode" class="chat-room-code"></div>
                            <button id="menuChatCopyCodeBtn" class="chat-copy-btn">ğŸ“‹ Copier</button>
                            <p class="chat-room-hint">Partagez ce code avec vos amis !</p>
                        </div>
                    </div>
                </div>

                <!-- Interface des messages -->
                <div id="menuChatMessagesInterface" class="chat-messages-interface hidden">
                    <div id="menuChatMessages" class="chat-messages">
                        <!-- Les messages seront ajoutÃ©s dynamiquement -->
                    </div>

                    <div class="chat-input-container">
                        <input type="text" id="menuChatInput" class="chat-input" placeholder="Ã‰crivez un message..." maxlength="200">
                        <button id="menuChatSendBtn" class="chat-send-btn">ğŸ“¤</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Multijoueur -->
    <div id="multiplayerModal" class="kawaii-modal hidden">
        <div class="kawaii-modal-overlay"></div>
        <div class="kawaii-modal-content">
            <div class="kawaii-modal-header">
                <span class="kawaii-modal-icon">ğŸ‘¥</span>
            </div>
            <div class="kawaii-modal-body">
                <h3>Mode CoopÃ©ratif</h3>
                <p>RÃ©solvez un niveau Ã  deux ! Chaque joueur trouve des mots diffÃ©rents.</p>
                
                <div id="multiplayerMenu">
                    <input type="text" id="multiplayerPlayerName" placeholder="Votre nom" class="kawaii-input" style="width: 100%; margin: 10px 0; padding: 12px; border: 2px solid #ff69b4; border-radius: 10px;">
                    <button id="createRoomBtn" class="kawaii-modal-button" style="width: 100%; margin: 5px 0;">
                        ğŸ® CrÃ©er une Partie
                    </button>
                    <button id="joinRoomBtn" class="kawaii-modal-button secondary" style="width: 100%; margin: 5px 0;">
                        ğŸ”— Rejoindre une Partie
                    </button>
                </div>

                <div id="roomCodeDisplay" class="hidden" style="margin: 20px 0; padding: 15px; background: #fff5f9; border-radius: 10px; text-align: center;">
                    <p><strong>Code de la partie:</strong></p>
                    <p id="roomCode" style="font-size: 24px; color: #ff1493; font-weight: bold; letter-spacing: 2px; user-select: all;"></p>
                    <button id="copyCodeBtn" class="kawaii-modal-button" style="margin-top: 10px;">
                        ğŸ“‹ Copier le Code
                    </button>
                    <p style="margin-top: 10px; font-size: 14px; color: #666;">En attente du partenaire...</p>
                </div>

                <div id="joinRoomInput" class="hidden" style="margin: 20px 0;">
                    <input type="text" id="roomCodeInput" placeholder="Code de la partie" class="kawaii-input" style="width: 100%; padding: 12px; border: 2px solid #ff69b4; border-radius: 10px; margin-bottom: 10px;">
                    <button id="connectBtn" class="kawaii-modal-button" style="width: 100%;">
                        âœ… Se Connecter
                    </button>
                </div>
            </div>
            <div class="kawaii-modal-footer">
                <button id="closeMultiplayerBtn" class="kawaii-modal-button secondary">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Modal de Collection de MÃ©dailles -->
    <div id="achievementsModal" class="kawaii-modal hidden">
        <div class="kawaii-modal-overlay"></div>
        <div class="kawaii-modal-content achievements-modal-content">
            <div class="menu-header">
                <h2>ğŸ† Collection de MÃ©dailles</h2>
                <button id="closeAchievementsBtn" class="close-menu-btn">âœ•</button>
            </div>

            <!-- Stats globales -->
            <div class="achievements-stats">
                <div class="stat-item">
                    <div class="stat-value" id="achievementCount">0/0</div>
                    <div class="stat-label">MÃ©dailles</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="achievementPoints">0</div>
                    <div class="stat-label">Points</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="completionPercent">0%</div>
                    <div class="stat-label">ComplÃ©tion</div>
                </div>
            </div>

            <!-- Filtres -->
            <div class="achievements-filters">
                <button class="filter-btn active" data-filter="all">Toutes</button>
                <button class="filter-btn" data-filter="unlocked">DÃ©bloquÃ©es</button>
                <button class="filter-btn" data-filter="locked">VerrouillÃ©es</button>
            </div>

            <!-- Liste des achievements -->
            <div id="achievementsList" class="achievements-list"></div>
        </div>
    </div>

    <!-- Modal d'authentification -->
    <div id="authModal" class="kawaii-modal hidden">
        <div class="kawaii-modal-overlay"></div>
        <div class="kawaii-modal-content auth-modal-content">
            <div class="kawaii-modal-header">
                <span class="kawaii-modal-icon">ğŸ”</span>
            </div>
            <div class="kawaii-modal-body">
                <h2 style="color: #ff69b4; margin-bottom: 15px;">Connexion au Chat</h2>
                <p style="color: #666; margin-bottom: 20px;">Connectez-vous pour utiliser le chat communautaire</p>

                <!-- Formulaire de connexion/inscription -->
                <form id="authForm" style="display: flex; flex-direction: column; gap: 15px;">
                    <input
                        type="text"
                        id="authUsername"
                        placeholder="Nom d'utilisateur"
                        required
                        maxlength="20"
                        style="padding: 12px; border: 2px solid #ffe8f0; border-radius: 10px; font-size: 0.95rem; outline: none;"
                    >
                    <input
                        type="email"
                        id="authEmail"
                        placeholder="Votre email"
                        required
                        style="padding: 12px; border: 2px solid #ffe8f0; border-radius: 10px; font-size: 0.95rem; outline: none;"
                    >

                    <div id="authMessage" style="padding: 10px; border-radius: 8px; display: none; font-size: 0.9rem;"></div>

                    <button
                        type="submit"
                        id="authSubmitBtn"
                        class="kawaii-modal-button"
                        style="width: 100%;"
                    >
                        ğŸ“§ Envoyer le lien de connexion
                    </button>
                </form>

                <p style="font-size: 0.85rem; color: #999; margin-top: 15px; line-height: 1.5;">
                    Un lien de vÃ©rification sera envoyÃ© Ã  votre email. Cliquez sur le lien pour vous connecter.
                </p>
            </div>
            <div class="kawaii-modal-footer">
                <button id="authCancelBtn" class="kawaii-modal-button secondary">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Modules JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    <script src="js/i18n.js"></script>
    <script src="js/gameData.js"></script>
    <script src="js/achievements.js"></script>
    <script src="js/biblicalQuotes.js"></script>
    <script src="js/shareImage.js"></script>
    <script src="js/supabase.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/menu-tabs.js"></script>
    <script src="js/chat.js"></script>
    <script src="js/multiplayer.js"></script>
    <script src="js/game.js"></script>

    <!-- Service Worker Registration -->
    <script>
        // Enregistrer le Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then((registration) => {
                        console.log('âœ… Service Worker enregistrÃ©:', registration.scope);
                        
                        // VÃ©rifier les mises Ã  jour
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // Nouvelle version disponible
                                    if (confirm('ğŸ‰ Nouvelle version disponible ! Voulez-vous mettre Ã  jour ?')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.log('âŒ Erreur Service Worker:', error);
                    });
            });

            // GÃ©rer les mises Ã  jour du Service Worker
            let refreshing = false;
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                if (!refreshing) {
                    refreshing = true;
                    window.location.reload();
                }
            });
        }

        // GÃ©rer l'Ã©vÃ©nement d'installation de la PWA
        let deferredPrompt;
        const installButton = document.getElementById('installButton');
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Afficher le bouton d'installation
            if (installButton) {
                installButton.classList.remove('hidden');
                installButton.addEventListener('click', async () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        const { outcome } = await deferredPrompt.userChoice;
                        console.log(`Installation: ${outcome}`);
                        deferredPrompt = null;
                        installButton.classList.add('hidden');
                    }
                });
            }
        });

        // DÃ©tecter quand l'app est installÃ©e
        window.addEventListener('appinstalled', () => {
            console.log('ğŸ‰ Application installÃ©e avec succÃ¨s!');
            if (installButton) {
                installButton.classList.add('hidden');
            }
            deferredPrompt = null;
        });
    </script>
</body>
</html>
