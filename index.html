<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#ff69b4">
    <meta name="description" content="Jeu de mots croisÃ©s chrÃ©tiens avec un design kawaii rose Ã©lÃ©gant">
    <title>ğŸ’• Mots En Croix ChrÃ©tiens ğŸ’•</title>
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ff69b4">
    
    <!-- iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Mots Croix">
    <link rel="apple-touch-icon" href="icons/icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180.png">
    
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>ğŸ™ Mots En Croix ChrÃ©tiens ğŸ™</h1>
            <p>Trouve les mots d'encouragement et les mots bibliques</p>
            <button id="installButton" class="install-button hidden">
                ğŸ“± Installer l'Application
            </button>
            <div id="languageSelector" class="language-selector"></div>
        </div>

        <div class="level-info">
            <div>
                <strong>Niveau: <span id="currentLevel">1</span>/8</strong>
            </div>
            <div class="score-display">
                Score: <span id="score">0</span> points
            </div>
        </div>

        <div id="startScreen">
            <button class="play-button" id="playButton">
                ğŸ® Jouer (<span id="clickCount">0</span>/7)
            </button>
            <div class="encouraging-words" id="encouragingWords"></div>
        </div>

        <div id="gameScreen" class="hidden">
            <div class="crossword-grid" id="crosswordGrid"></div>
            
            <div class="word-clues">
                <div class="clue-section">
                    <h3>â¡ï¸ Horizontal</h3>
                    <div id="horizontalClues"></div>
                </div>
                <div class="clue-section">
                    <h3>â¬‡ï¸ Vertical</h3>
                    <div id="verticalClues"></div>
                </div>
            </div>

            <div class="controls">
                <button class="control-btn" id="checkButton">âœ… VÃ©rifier</button>
                <button class="control-btn" id="hintButton">ğŸ’¡ Indice</button>
                <button class="control-btn" id="nextLevelButton" style="display:none;">â¡ï¸ Niveau Suivant</button>
                <button class="control-btn" id="resetButton">ğŸ”„ Recommencer</button>
            </div>
        </div>
    </div>

    <!-- Modules JavaScript -->
    <script src="js/config.js"></script>
    <script src="js/i18n.js"></script>
    <script src="js/gameData.js"></script>
    <script src="js/game.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        // Enregistrer le Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then((registration) => {
                        console.log('âœ… Service Worker enregistrÃ©:', registration.scope);
                        
                        // VÃ©rifier les mises Ã  jour
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // Nouvelle version disponible
                                    if (confirm('ğŸ‰ Nouvelle version disponible ! Voulez-vous mettre Ã  jour ?')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.log('âŒ Erreur Service Worker:', error);
                    });
            });

            // GÃ©rer les mises Ã  jour du Service Worker
            let refreshing = false;
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                if (!refreshing) {
                    refreshing = true;
                    window.location.reload();
                }
            });
        }

        // GÃ©rer l'Ã©vÃ©nement d'installation de la PWA
        let deferredPrompt;
        const installButton = document.getElementById('installButton');
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Afficher le bouton d'installation
            if (installButton) {
                installButton.classList.remove('hidden');
                installButton.addEventListener('click', async () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        const { outcome } = await deferredPrompt.userChoice;
                        console.log(`Installation: ${outcome}`);
                        deferredPrompt = null;
                        installButton.classList.add('hidden');
                    }
                });
            }
        });

        // DÃ©tecter quand l'app est installÃ©e
        window.addEventListener('appinstalled', () => {
            console.log('ğŸ‰ Application installÃ©e avec succÃ¨s!');
            if (installButton) {
                installButton.classList.add('hidden');
            }
            deferredPrompt = null;
        });
    </script>
</body>
</html>
